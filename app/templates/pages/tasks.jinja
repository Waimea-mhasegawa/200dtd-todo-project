{#=====================================================
  Task page for group
  - Shows all tasks of each groups
  - Form to add a new task
=====================================================#}

{% extends 'pages/base.jinja' %}


{% block title %}

    Family To-Do - Tasks in {{ group.name }}

{% endblock %}


{% block content %}

    <a href="/groups" role="button" >‚Üê Back to Groups</a>

    <h1>Tasks in "{{ group.name }}"</h1>


    <article>
        <ul>
        {% for task in tasks %}
            <li>
            <strong>{{ task.name }}</strong>

            {% if task.description %}
                - {{ task.description }}
            {% endif %}    

            (Priority: {{ task.priority }})

            {% if task.colour %}
            <div class="task-card"
                 style="background-color: {{ task.colour or '#f0f0f0' }};">
                {{ task.name }}
            </div>

            {% endif %}

            {% if task.picture %}
                <img src="{{ task.picture }}" alt="task picture" width="40">
            {% endif %}

            {# Add a link for edit #}
            <a href="/tasks/{{ task.id }}/edit"></a>

            {# Edit button #}
            <button onclick="document.getElementById('edit-task-{{ task.id }}').showModal()">Edit</button>
                        
            {# Add a link to delete & Delete button #}
            <a href="/tasks/{{ task.id }}/delete" onclick="return confirm('Delete the task?');">x</a>
            </li>
            

            <li>
                
            {# Edit modal #}
                <dialog id="edit-task-{{ task.id }}">

                    <article>
                        <h3>Edit Task "{{ task.name }}"</h3>

                        <form action="/tasks/{{ task.id }}/edit" method="POST" enctype="multipart/form-data">

                            <input type="hidden" name="group_id" value="{{ task.group_id }}">

                            <label>
                                Task Name:

                                <input type="text" name="name" value="{{ task.name }}" required>
                            </label>

                            <label>
                                Description:

                                <textarea name="description">{{ task.description }}</textarea>
                            </label>

                            <label>
                                Priority:

                                <select name="priority" required>

                                    {% for p in [1,2,3,4,5] %}
                                        <option value="{{ p }}" {% if task.priority == p %}selected{% endif %}>{{ p }}</option>
                                    {% endfor %}

                                </select>
                            </label>

                            <label>
                                Task Colour:

                                <input type="color" name="colour" value="{{ task.colour }}">
                            </label>

                            <label>
                                Picture:

                                <input type="file" name="picture" accept="image/*">
                            </label>

                            <footer>
                                <button type="submit">Save Changes</button>
                                <button type="button" onclick="document.getElementById('edit-task-{{ task.id }}').close()">Cancel</button>
                            </footer>
                        </form>
                    </article>
                </dialog>
            </li>
            
            {% else %}
                <p>No tasks in this group.</p>
            {% endfor %}
        </ul>

    </article>

    <a href="/tasks/add" role="button" ><strong>+</strong></a>

{% endblock %}
